<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rogers Sales Reporter</title>
    <!-- Use Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .whatsapp-message-box {
            background-color: #e0f2fe; /* Light blue background for the message box */
            border-radius: 12px;
            padding: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
            font-size: 1rem;
            color: #1f2937;
            text-align: left;
            overflow-y: auto;
            max-height: 500px;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6">

    <div class="w-full max-w-2xl bg-white p-6 rounded-3xl shadow-xl flex flex-col space-y-6 md:p-10">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-gray-800">Rogers Sales Reporter</h1>
        <p class="text-center text-gray-600">
            Paste the raw data below and click "Generate Report" to create a formatted WhatsApp message.
        </p>

        <!-- Input Section -->
        <div>
            <label for="inputData" class="block text-sm font-medium text-gray-700 mb-1">Raw Data String:</label>
            <textarea id="inputData" rows="6" placeholder="e.g. Ameya 3 0 0..." class="w-full p-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 resize-none"></textarea>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="generateBtn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-all duration-200 transform hover:scale-105">
                Generate Report
            </button>
            <button id="copyBtn" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-green-600 transition-all duration-200 transform hover:scale-105 hidden">
                Copy to Clipboard
            </button>
        </div>

        <!-- Output Section -->
        <div id="outputContainer" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-2">Formatted Message:</label>
            <div id="outputMessage" class="whatsapp-message-box"></div>
        </div>

        <!-- Custom Alert Box -->
        <div id="customAlert" class="fixed inset-0 bg-gray-600 bg-opacity-50 z-50 hidden flex items-center justify-center">
            <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                <p id="alertMessage" class="text-lg font-semibold text-gray-800 mb-4"></p>
                <button id="closeAlert" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">OK</button>
            </div>
        </div>

    </div>

    <script>
        // Custom alert function to avoid using window.alert
        function showAlert(message) {
            const alertBox = document.getElementById('customAlert');
            const alertMessage = document.getElementById('alertMessage');
            const closeBtn = document.getElementById('closeAlert');
            alertMessage.textContent = message;
            alertBox.classList.remove('hidden');
            closeBtn.onclick = () => {
                alertBox.classList.add('hidden');
            };
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const inputData = document.getElementById('inputData');
            const generateBtn = document.getElementById('generateBtn');
            const outputMessage = document.getElementById('outputMessage');
            const outputContainer = document.getElementById('outputContainer');
            const copyBtn = document.getElementById('copyBtn');
        
            generateBtn.addEventListener('click', () => {
                const rawData = inputData.value.trim();
                if (!rawData) {
                    showAlert("Please enter some data to generate the report.");
                    return;
                }
        
                // Split the input into lines
                const lines = rawData.split('\n').filter(line => line.trim() !== '');
                if (lines.length === 0) {
                    showAlert("No valid data found. Please check the format.");
                    outputContainer.classList.add('hidden');
                    copyBtn.classList.add('hidden');
                    return;
                }
        
                let people = [];
                let totalNHC = 0;
        
                lines.forEach(line => {
                    const parts = line.trim().split(/\s+/).filter(part => part !== '' && part !== 'off');
        
                    if (parts.length < 4) {
                        // Skip lines that don't conform to the expected format
                        // This handles lines like "IN FIELD TRAINING"
                        return;
                    }
        
                    const name = parts[0];
                    // The last three parts of the line are the numbers we need
                    const lastThree = parts.slice(-3);
        
                    const nhc1 = parseInt(lastThree[0], 10) || 0;
                    const nhc2 = parseInt(lastThree[1], 10) || 0;
                    const nhc3 = parseInt(lastThree[2], 10) || 0;
        
                    // The core logic change: only use the first number for the NHC total
                    const nhcSum = nhc1;
                    totalNHC += nhcSum;
        
                    people.push({
                        name: name,
                        nhcSum: nhcSum,
                        digits: `${nhc1}+${nhc2}+${nhc3}`
                    });
                });
        
                if (people.length === 0) {
                    showAlert("No valid data found. Please check the format.");
                    outputContainer.classList.add('hidden');
                    copyBtn.classList.add('hidden');
                    return;
                }
        
                // Sort people by NHC sum in descending order
                people.sort((a, b) => b.nhcSum - a.nhcSum);
        
                // Group people by tiers
                const tiers = {
                    'Tier 1 Bonus 0-3 NHC': [],
                    'Tier 2 Bonus 4-5 NHC': [],
                    'Tier 3 Bonus 6-8 NHC': [],
                    'Tier 4 Bonus 9+ NHC': []
                };
        
                const shoutoutTiers = {
                    'Tier 2': [],
                    'Tier 3': [],
                    'Tier 4': []
                };
        
                people.forEach(person => {
                    const bonusEmoji = person.nhcSum >= 9 ? '🏆' : person.nhcSum >= 6 ? '🥇' : person.nhcSum >= 4 ? '🥈' : '🥉';
                    const nameWithEmoji = `@${person.name} ${bonusEmoji} ${person.digits} = ${person.nhcSum}`;
        
                    if (person.nhcSum >= 9) {
                        tiers['Tier 4 Bonus 9+ NHC'].push(nameWithEmoji);
                        shoutoutTiers['Tier 4'].push(`@${person.name}`);
                    } else if (person.nhcSum >= 6) {
                        tiers['Tier 3 Bonus 6-8 NHC'].push(nameWithEmoji);
                        shoutoutTiers['Tier 3'].push(`@${person.name}`);
                    } else if (person.nhcSum >= 4) {
                        tiers['Tier 2 Bonus 4-5 NHC'].push(nameWithEmoji);
                        shoutoutTiers['Tier 2'].push(`@${person.name}`);
                    } else {
                        tiers['Tier 1 Bonus 0-3 NHC'].push(nameWithEmoji);
                    }
                });
        
                // Build the final message string
                let message = `Hey Team !!!!!! 🎉\n\nHERE IS THE DAILY UPDATE\n\nThe opportunity is for everyone, but not everyone will get there. Pick your side and commit to it 👇\n\n(UP TO YESTERDAY)\n\n📊 TIER BONUS 📊\n\n`;
        
                // Add tiers to the message, starting from Tier 4 down to Tier 1
                const tierKeys = ['Tier 4 Bonus 9+ NHC', 'Tier 3 Bonus 6-8 NHC', 'Tier 2 Bonus 4-5 NHC', 'Tier 1 Bonus 0-3 NHC'];
                tierKeys.forEach(tier => {
                    if (tiers[tier].length > 0) {
                        const tierHeading = tier.includes('Tier 1') ? 'TIER 1 BONUS 0-3 NHC: $0/SALE' :
                                            tier.includes('Tier 2') ? 'TIER 2 BONUS 4-5 NHC: $25/SALE' :
                                            tier.includes('Tier 3') ? 'TIER 3 BONUS 6-8 NHC: $50/SALE' :
                                            'TIER 4 BONUS 9+ NHC : $70/SALE';
                        message += `\n${tierHeading}\n`
                        message += tiers[tier].join('\n');
                        message += '\n';
                    }
                });
                
                message += `\nTOTAL NHC: ${totalNHC} 🏆\n\n`;
        
                // Add shoutouts section
                message += `BIG SHOUTOUTS TEAM 🔥\n\n`;
                if (shoutoutTiers['Tier 4'].length > 0) {
                     message += `High Rollers pushing the limits: \n`
                     message += shoutoutTiers['Tier 4'].join('\n') + `\n\n`;
                }
                if (shoutoutTiers['Tier 3'].length > 0) {
                    message += `Tier 3 rockstars:\n`;
                    message += shoutoutTiers['Tier 3'].join('\n') + `\n\n`;
                }
                if (shoutoutTiers['Tier 2'].length > 0) {
                    message += `Tier 2 hitters bringing the energy this week:\n`;
                    message += shoutoutTiers['Tier 2'].join('\n') + `\n\n`;
                }
                
                // Add concluding message
                message += `Great efforts from everyone pushing through! A lot of us didn’t hit the standards this week and left opportunities on the table, but that just means we’ve got unfinished business.\n\nLet’s make the upcoming week an EXPLOSIVE ONE! 🚀 Bring back the intensity and set the tone!\n\n"The opportunity is for everyone, but not everyone will get there. Pick your side and commit to it."`;
        
                outputMessage.textContent = message;
                outputContainer.classList.remove('hidden');
                copyBtn.classList.remove('hidden');
            });
        
            copyBtn.addEventListener('click', () => {
                const messageToCopy = outputMessage.textContent;
                const tempTextarea = document.createElement('textarea');
                tempTextarea.value = messageToCopy;
                document.body.appendChild(tempTextarea);
                tempTextarea.select();
                tempTextarea.setSelectionRange(0, 99999); // For mobile devices
                document.execCommand('copy');
                document.body.removeChild(tempTextarea);
                showAlert("Message copied to clipboard!");
            });
        });
    </script>
</body>
</html>
